<!doctype html>
<html class="no-js" lang="en">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Marionette - Table</title>
        <link rel="stylesheet" href="bower_components/foundation/css/foundation.css" />
        <link rel="stylesheet" href="css/app.css" />
        <script src="bower_components/foundation/js/vendor/modernizr.js"></script>
    </head>

    <body>

        <div class="row">
            <div class="large-12 columns">
                <h1>Marionette Table - Test</h1>
            </div>
        </div>

        <!-- Here be rendered HTML by Marionette. -->
        <div class="row">
            <div class="large-12 columns">
                
                <div id="loading" class="panel callout radius">
                    <h5>Please wait, loading...</h5>
                </div>
                
                <div id="container"></div>

            </div>
        </div>

        <!-- JavaScript libraries -->
        <script src="bower_components/foundation/js/vendor/jquery.js"></script>
        <script src="bower_components/foundation/js/foundation.min.js"></script>
        <script src="bower_components/underscore/underscore-min.js"></script>
        <script src="bower_components/backbone/backbone-min.js"></script>
        <script src="bower_components/marionette/lib/backbone.marionette.min.js"></script>

        <!-- Application libraries -->
        <script src="app/backbone/UserModel.js"></script>
        <script src="app/backbone/UserCollection.js"></script>
        <script src="app/marionette/PaginatedTableView.js"></script>

        <!-- Bootstrap Application -->
        <script type="text/javascript">

            $(document).ready(function () {

                var userCollection = new UserCollection();
                var $loadingElem = $('#loading');

                // Load required assets.
                var templatesXhr = $.get('marionette-templates.html');
                var collXhr = userCollection.fetch();

                $.when(collXhr, templatesXhr).done(function (collResponse, templatesResponse) {

                    // FIXME Do we really need to inject into the DOM, only to pull back out again as a string?
                    // Thinking of angular-ng-templates grunt plugin, which compiles html into JS.
                    $(document.body).append(templatesResponse[0]); // html
                    
                    // TODO Use Marionette's regions/layouts.
                    var tableView = new PaginatedTableView({
                        // TODO Define "columns" here, and pass them down to itemView, for more dynamic display.
                        collection: userCollection,
                        pagination: {
                            // Default pagination settings.
                            perPage: 25,
                            perPageSelectorOptions: [25, 50, 100, 500, 10000]
                        },
                        // Document ready matters here!
                        rowTemplateHtml: $('#table-row-template').html(),
                        paginationTemplateHtml: $('#pagination-template').html()
                    });

                    // Nice way to decouple the loading display from the table view.
                    tableView.on('item:rendered', function () {
                        $loadingElem.addClass('hide');
                    });

                    // Render and append DOM using jQuery.
                    // TODO Faster way to render?
                    console.time('rendering App');
                    $('#container').append(tableView.render().$el);
                    console.timeEnd('rendering App');

                });

            });

        </script>

    </body>

</html>